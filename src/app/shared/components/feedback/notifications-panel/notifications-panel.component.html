<!-- src/app/shared/components/feedback/notifications-panel/notifications-panel.component.html -->
@if (isOpen) {
  <!-- Dropdown Container (no backdrop, positioned relative to header) -->
  <div 
    class="absolute top-full right-0 mt-2 w-96 max-w-sm bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 z-50 max-h-96 overflow-hidden"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
      <div class="flex items-center space-x-3">
        <lucide-icon [name]="bellIcon" class="w-5 h-5 text-gray-600 dark:text-gray-400"></lucide-icon>
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Notifications</h2>
        @if (getUnreadCount() > 0) {
          <span class="px-2 py-1 text-xs font-medium bg-primary-500 text-white rounded-full">
            {{ getUnreadCount() }}
          </span>
        }
      </div>
      
      <div class="flex items-center space-x-2">
        @if (getUnreadCount() > 0) {
          <button
            (click)="markAllAsRead()"
            class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 transition-colors"
            title="Mark all as read"
          >
            <lucide-icon [name]="checkIcon" class="w-4 h-4"></lucide-icon>
          </button>
        }
        
        <button
          (click)="onClose()"
          class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 transition-colors"
        >
          <lucide-icon [name]="checkIcon" class="w-4 h-4"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- Notifications List (shorter for dropdown) -->
    <div class="overflow-y-auto max-h-80">
      @if (filteredNotifications.length === 0) {
        <div class="flex flex-col items-center justify-center p-8 text-center">
          <lucide-icon [name]="bellIcon" class="w-12 h-12 text-gray-300 dark:text-gray-600 mb-4"></lucide-icon>
          <p class="text-gray-500 dark:text-gray-400 text-sm">No notifications</p>
        </div>
      } @else {
        <div class="divide-y divide-gray-100 dark:divide-gray-700">
          @for (notification of filteredNotifications; track notification.id) {
            <div 
              (click)="onNotificationClick(notification)"
              [class]="'p-3 cursor-pointer transition-colors ' +
                      (notification.read ? 
                       'bg-white dark:bg-gray-800' : 
                       'bg-blue-50 dark:bg-blue-900/10')"
            >
              <div class="flex space-x-3">
                <!-- Notification Icon -->
                <div class="flex-shrink-0">
                  <div [class]="'p-1 rounded ' + getPriorityBgColor(notification.priority)">
                    <lucide-icon 
                      [name]="getNotificationIcon(notification)" 
                      [class]="'w-3 h-3 ' + getPriorityColor(notification.priority)"
                    ></lucide-icon>
                  </div>
                </div>

                <!-- Notification Content -->
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900 dark:text-white truncate">
                    {{ notification.title }}
                  </p>
                  <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 line-clamp-2">
                    {{ notification.message }}
                  </p>
                  <div class="flex items-center justify-between mt-2">
                    <span class="text-xs text-gray-500 dark:text-gray-400">
                      {{ getRelativeTime(notification.timestamp) }}
                    </span>
                    @if (notification.action) {
                      <button
                        (click)="onActionClick(notification, $event)"
                        class="text-xs text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300"
                      >
                        {{ notification.action.label }}
                      </button>
                    }
                  </div>
                </div>

                <!-- Unread Indicator -->
                @if (!notification.read) {
                  <div class="w-2 h-2 bg-primary-500 rounded-full flex-shrink-0 mt-1"></div>
                }
              </div>
            </div>
          }
        </div>
      }
    </div>

    <!-- Footer -->
    @if (filteredNotifications.length > 0) {
      <div class="border-t border-gray-200 dark:border-gray-700 p-3">
        <button
          (click)="clearAllNotifications()"
          class="w-full text-center text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"
        >
          Clear All
        </button>
      </div>
    }
  </div>
}