<!-- src/app/shared/data-display/data-table/sub-components/data-table-body/data-table-body.component.html -->
<div class="overflow-x-auto">
  <table class="w-full">
    <!-- Table Header -->
    <thead class="bg-gray-50 dark:bg-gray-700/50">
      <tr>
        <!-- Select All Checkbox -->
        @if (config.selectable && config.multiSelect) {
          <th class="w-12 px-4 py-3">
            <input
              type="checkbox"
              [checked]="allSelected"
              [indeterminate]="someSelected && !allSelected"
              (change)="onSelectAllChange($event)"
              class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
            >
          </th>
        }

        <!-- Expand/Collapse -->
        @if (config.expandableRows) {
          <th class="w-12 px-4 py-3"></th>
        }

        <!-- Column Headers -->
        @for (column of columns; track column.key) {
          <th 
            (click)="onSortClick(column)"
            [class]="'px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer transition-colors ' +
                    (config.sortable && column.sortable ? 'hover:bg-gray-100 dark:hover:bg-gray-600' : '')"
            [style.width]="getColumnWidth(column)"
          >
            <div class="flex items-center space-x-1">
              <span>{{ column.label }}</span>
              @if (config.sortable && column.sortable) {
                <div class="flex flex-col">
                  <svg 
                    [class]="'w-3 h-3 ' + (sortedColumn === column.key && sortDirection === 'asc' ? 'text-primary-600 dark:text-primary-400' : 'text-gray-400')"
                    fill="none" stroke="currentColor" viewBox="0 0 24 24"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                  </svg>
                  <svg 
                    [class]="'w-3 h-3 ' + (sortedColumn === column.key && sortDirection === 'desc' ? 'text-primary-600 dark:text-primary-400' : 'text-gray-400')"
                    fill="none" stroke="currentColor" viewBox="0 0 24 24"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </div>
              }
            </div>
          </th>
        }

        <!-- Row Actions Header -->
        @if (config.rowActions.length > 0) {
          <th class="w-20 px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
            Actions
          </th>
        }
      </tr>
    </thead>

    <!-- Table Body -->
    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
      <!-- Loading State -->
      @if (loading) {
        @for (i of [1,2,3,4,5]; track i) {
          <tr>
            @if (config.selectable && config.multiSelect) {
              <td class="px-4 py-4"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"></div></td>
            }
            @if (config.expandableRows) {
              <td class="px-4 py-4"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"></div></td>
            }
            @for (column of columns; track column.key) {
              <td class="px-4 py-4"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"></div></td>
            }
            @if (config.rowActions.length > 0) {
              <td class="px-4 py-4"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"></div></td>
            }
          </tr>
        }
      }

      <!-- Data Rows -->
      @if (!loading) {
        @for (row of data; track getRowId(row); let even = $even) {
          <tr 
  (click)="onRowClick(row)"
  [class]="getRowClass(row, even)"
>
            <!-- Row Checkbox -->
            @if (config.selectable && config.multiSelect) {
              <td class="px-4 py-4 whitespace-nowrap">
                <input
                  type="checkbox"
                  [checked]="isRowSelected(row)"
                  (click)="$event.stopPropagation()"
                  (change)="onRowSelectChange($event, row)"
                  class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                >
              </td>
            }

            <!-- Expand/Collapse Button -->
            @if (config.expandableRows) {
              <td class="px-4 py-4 whitespace-nowrap">
                <button
                  (click)="onExpandClick(row, $event)"
                  class="p-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                >
                  <svg 
                    [class]="'w-4 h-4 transform transition-transform ' + (isRowExpanded(row) ? 'rotate-180' : '')"
                    fill="none" stroke="currentColor" viewBox="0 0 24 24"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </button>
              </td>
            }

            <!-- Data Cells -->
            @for (column of columns; track column.key) {
              <td 
                [class]="getCellClass(column, row[column.key], row)"
                [style.width]="getColumnWidth(column)"
              >
                @if (column.editable && config.inlineEdit) {
                  <input
                    type="text"
                    [value]="row[column.key]"
                    (input)="onCellEdit(row, column, $event)"
                    (click)="$event.stopPropagation()"
                    class="w-full px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                  >
                } @else {
                  <span [innerHTML]="formatCellValue(column, row[column.key], row)"></span>
                }
              </td>
            }

            <!-- Row Actions -->
            @if (config.rowActions.length > 0) {
              <td class="px-4 py-4 whitespace-nowrap">
                <div class="flex items-center space-x-2" (click)="$event.stopPropagation()">
                  @for (action of config.rowActions; track action.id) {
                    @if (isActionVisible(action, row)) {
                      <button
                        (click)="onActionClick(action, row, $event)"
                        [disabled]="isActionDisabled(action, row)"
                        [class]="'p-1 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed ' +
                                (action.variant === 'danger' ? 'text-red-600 hover:bg-red-100 dark:hover:bg-red-900' :
                                 action.variant === 'secondary' ? 'text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700' :
                                 action.variant === 'ghost' ? 'text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700' :
                                 'text-primary-600 hover:bg-primary-100 dark:hover:bg-primary-900')"
                        [title]="action.label"
                      >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
                        </svg>
                      </button>
                    }
                  }
                </div>
              </td>
            }
          </tr>

          <!-- Expanded Row Content -->
          @if (config.expandableRows && isRowExpanded(row)) {
            <tr>
              <td [colSpan]="columns.length + (config.selectable && config.multiSelect ? 1 : 0) + (config.expandableRows ? 1 : 0) + (config.rowActions.length > 0 ? 1 : 0)" 
                  class="px-4 py-4 bg-gray-50 dark:bg-gray-700/30">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                  <!-- Expanded content would go here -->
                  Expanded details for {{ getRowId(row) }}
                </div>
              </td>
            </tr>
          }
        }

        <!-- Empty State -->
        @if (data.length === 0) {
          <tr>
            <td [colSpan]="columns.length + (config.selectable && config.multiSelect ? 1 : 0) + (config.expandableRows ? 1 : 0) + (config.rowActions.length > 0 ? 1 : 0)" 
                class="px-4 py-8 text-center">
              <div class="text-gray-500 dark:text-gray-400">
                <svg class="w-12 h-12 mx-auto mb-4 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0H4"></path>
                </svg>
                <p class="text-lg font-medium">No data found</p>
                <p class="text-sm">Try adjusting your search or filter</p>
              </div>
            </td>
          </tr>
        }
      }
    </tbody>
  </table>
</div>