<!-- src/app/shared/components/user/user-profile/user-profile.component.html -->
@if (isOpen) {
  <!-- Backdrop -->
  <div 
    class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4 user-profile-backdrop"
    (click)="onClose()"
  >
    <!-- Profile Modal -->
    <div 
      class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center space-x-3">
          <h2 class="text-xl font-bold text-gray-900 dark:text-white">User Profile</h2>
          @if (userData.status) {
            <span [class]="'px-2 py-1 text-xs font-medium rounded-full ' + getStatusColor(userData.status)">
              {{ userData.status.charAt(0).toUpperCase() + userData.status.slice(1) }}
            </span>
          }
          @if (isEditing) {
            <span class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300 rounded-full">
              Editing
            </span>
          }
        </div>
        
        <div class="flex items-center space-x-2">
          @if (showEdit) {
            @if (isEditing) {
              <button
                (click)="saveProfile()"
                [disabled]="!hasChanges"
                class="flex items-center space-x-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-xl transition-colors"
              >
                <lucide-icon [name]="saveIcon" class="w-4 h-4"></lucide-icon>
                <span>Save</span>
              </button>
              
              <button
                (click)="cancelEditing()"
                class="flex items-center space-x-2 px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl transition-colors"
              >
                <lucide-icon [name]="closeIcon" class="w-4 h-4"></lucide-icon>
                <span>Cancel</span>
              </button>
            } @else {
              <button
                (click)="startEditing()"
                class="flex items-center space-x-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-xl transition-colors"
              >
                <lucide-icon [name]="editIcon" class="w-4 h-4"></lucide-icon>
                <span>Edit Profile</span>
              </button>
            }
          }
          
          <button
            (click)="onClose()"
            class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
          >
            <lucide-icon [name]="closeIcon" class="w-5 h-5 text-gray-500 dark:text-gray-400"></lucide-icon>
          </button>
        </div>
      </div>

      <div class="flex h-[calc(90vh-80px)]">
        <!-- Sidebar Navigation -->
        <div class="w-64 border-r border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50">
          <!-- User Summary -->
          <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <div class="flex flex-col items-center text-center">
              <!-- Avatar -->
              <div class="relative mb-3">
                <app-user-avatar
                  [user]="{
                    id: userData.id,
                    name: displayName,
                    email: userData.email,
                    avatar: currentAvatar
                  }"
                  [size]="'xl'"
                  [border]="true"
                ></app-user-avatar>
                
                @if (isEditing && showEdit) {
                  <label class="absolute bottom-0 right-0 p-1 bg-primary-500 text-white rounded-full cursor-pointer shadow-lg">
                    <lucide-icon [name]="uploadIcon" class="w-4 h-4"></lucide-icon>
                    <input
                      type="file"
                      accept="image/*"
                      class="hidden"
                      (change)="onAvatarSelected($event)"
                    >
                  </label>
                }
              </div>
              
              <h3 class="font-semibold text-gray-900 dark:text-white">{{ displayName }}</h3>
              <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">{{ userData.email }}</p>
              @if (userData.jobTitle) {
                <p class="text-xs text-primary-600 dark:text-primary-400 font-medium mt-1">
                  {{ userData.jobTitle }}
                </p>
              }
              @if (userData.department) {
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                  {{ userData.department }}
                </p>
              }
            </div>
          </div>

          <!-- Navigation -->
          <nav class="p-4 space-y-1">
            <button
              (click)="setActiveTab('overview')"
              [class]="'w-full flex items-center space-x-3 px-3 py-2 rounded-xl transition-colors ' +
                      (activeTab === 'overview' ? 
                       'bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300' : 
                       'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800')"
            >
              <lucide-icon [name]="usersIcon" class="w-4 h-4"></lucide-icon>
              <span>Overview</span>
            </button>

            <button
              (click)="setActiveTab('personal')"
              [class]="'w-full flex items-center space-x-3 px-3 py-2 rounded-xl transition-colors ' +
                      (activeTab === 'personal' ? 
                       'bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300' : 
                       'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800')"
            >
              <lucide-icon [name]="usersIcon" class="w-4 h-4"></lucide-icon>
              <span>Personal Info</span>
            </button>

            <button
              (click)="setActiveTab('job')"
              [class]="'w-full flex items-center space-x-3 px-3 py-2 rounded-xl transition-colors ' +
                      (activeTab === 'job' ? 
                       'bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300' : 
                       'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800')"
            >
              <lucide-icon [name]="briefcaseIcon" class="w-4 h-4"></lucide-icon>
              <span>Job Information</span>
            </button>

            <button
              (click)="setActiveTab('settings')"
              [class]="'w-full flex items-center space-x-3 px-3 py-2 rounded-xl transition-colors ' +
                      (activeTab === 'settings' ? 
                       'bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300' : 
                       'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800')"
            >
              <lucide-icon [name]="shieldIcon" class="w-4 h-4"></lucide-icon>
              <span>Settings</span>
            </button>
          </nav>
        </div>

        <!-- Content Area -->
        <div class="flex-1 overflow-auto">
          <!-- Overview Tab -->
          @if (activeTab === 'overview') {
            <div class="p-6">
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Profile Overview</h3>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Contact Information -->
                <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-6">
                  <h4 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                    <lucide-icon [name]="usersIcon" class="w-5 h-5 mr-2"></lucide-icon>
                    Contact Information
                  </h4>
                  
                  <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                      <lucide-icon [name]="mailIcon" class="w-4 h-4 text-gray-400"></lucide-icon>
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Email</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ userData.email }}</p>
                      </div>
                    </div>
                    
                    @if (userData.phone) {
                      <div class="flex items-center space-x-3">
                        <lucide-icon [name]="phoneIcon" class="w-4 h-4 text-gray-400"></lucide-icon>
                        <div>
                          <p class="text-sm font-medium text-gray-900 dark:text-white">Phone</p>
                          <p class="text-sm text-gray-600 dark:text-gray-400">{{ userData.phone }}</p>
                        </div>
                      </div>
                    }
                  </div>
                </div>

                <!-- Job Information -->
                <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-6">
                  <h4 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                    <lucide-icon [name]="briefcaseIcon" class="w-5 h-5 mr-2"></lucide-icon>
                    Job Information
                  </h4>
                  
                  <div class="space-y-3">
                    @if (userData.jobTitle) {
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Job Title</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ userData.jobTitle }}</p>
                      </div>
                    }
                    
                    @if (userData.department) {
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Department</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ userData.department }}</p>
                      </div>
                    }
                    
                    @if (userData.employeeId) {
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Employee ID</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ userData.employeeId }}</p>
                      </div>
                    }
                  </div>
                </div>

                <!-- Personal Details -->
                <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-6">
                  <h4 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                    <lucide-icon [name]="usersIcon" class="w-5 h-5 mr-2"></lucide-icon>
                    Personal Details
                  </h4>
                  
                  <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                      <lucide-icon [name]="globeIcon" class="w-4 h-4 text-gray-400"></lucide-icon>
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Language</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ getLanguageName(userData.language) }}</p>
                      </div>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                      <lucide-icon [name]="clockIcon" class="w-4 h-4 text-gray-400"></lucide-icon>
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Timezone</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ userData.timezone }}</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- System Information -->
                <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-6">
                  <h4 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                    <lucide-icon [name]="activityIcon" class="w-5 h-5 mr-2"></lucide-icon>
                    System Information
                  </h4>
                  
                  <div class="space-y-3">
                    @if (userData.joinDate) {
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Join Date</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ userData.joinDate | date:'mediumDate' }}</p>
                      </div>
                    }
                    
                    @if (userData.lastLogin) {
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Last Login</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ userData.lastLogin | date:'medium' }}</p>
                      </div>
                    }
                    
                    <div>
                      <p class="text-sm font-medium text-gray-900 dark:text-white">Status</p>
                      <span [class]="'px-2 py-1 text-xs font-medium rounded-full ' + getStatusColor(userData.status)">
                        {{ userData.status?.charAt(0).toUpperCase() + userData.status?.slice(1) || 'Active' }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          }

          <!-- Personal Info Tab -->
          @if (activeTab === 'personal') {
            <div class="p-6">
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Personal Information</h3>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Basic Information -->
                <div class="space-y-6">
                  <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-4">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-4">Basic Information</h4>
                    
                    <div class="space-y-4">
                      <!-- First Name -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                          First Name
                        </label>
                        @if (isEditing) {
                          <input
                            type="text"
                            [(ngModel)]="editedData.firstName"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                          >
                        } @else {
                          <p class="text-gray-900 dark:text-white">{{ userData.firstName }}</p>
                        }
                      </div>

                      <!-- Last Name -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                          Last Name
                        </label>
                        @if (isEditing) {
                          <input
                            type="text"
                            [(ngModel)]="editedData.lastName"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                          >
                        } @else {
                          <p class="text-gray-900 dark:text-white">{{ userData.lastName }}</p>
                        }
                      </div>

                      <!-- Email -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                          <lucide-icon [name]="mailIcon" class="w-4 h-4 inline mr-1"></lucide-icon>
                          Email Address
                        </label>
                        @if (isEditing) {
                          <input
                            type="email"
                            [(ngModel)]="editedData.email"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                          >
                        } @else {
                          <p class="text-gray-900 dark:text-white">{{ userData.email }}</p>
                        }
                      </div>

                      <!-- Phone -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                          <lucide-icon [name]="phoneIcon" class="w-4 h-4 inline mr-1"></lucide-icon>
                          Phone Number
                        </label>
                        @if (isEditing) {
                          <input
                            type="tel"
                            [(ngModel)]="editedData.phone"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                          >
                        } @else {
                          <p class="text-gray-900 dark:text-white">{{ userData.phone || 'Not provided' }}</p>
                        }
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Additional Information -->
                <div class="space-y-6">
                  <!-- Personal Details -->
                  <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-4">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-4">Personal Details</h4>
                    
                    <div class="space-y-4">
                      <!-- Language -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                          Language
                        </label>
                        @if (isEditing) {
                          <select
                            [(ngModel)]="editedData.language"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                          >
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                          </select>
                        } @else {
                          <p class="text-gray-900 dark:text-white">{{ getLanguageName(userData.language) }}</p>
                        }
                      </div>

                      <!-- Timezone -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                          Timezone
                        </label>
                        @if (isEditing) {
                          <select
                            [(ngModel)]="editedData.timezone"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                          >
                            <option value="UTC">UTC</option>
                            <option value="America/New_York">Eastern Time</option>
                            <option value="America/Chicago">Central Time</option>
                            <option value="America/Denver">Mountain Time</option>
                            <option value="America/Los_Angeles">Pacific Time</option>
                          </select>
                        } @else {
                          <p class="text-gray-900 dark:text-white">{{ userData.timezone }}</p>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          }

          <!-- Job Information Tab -->
          @if (activeTab === 'job') {
            <div class="p-6">
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Job Information</h3>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="space-y-6">
                  <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-4">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-4">Employment Details</h4>
                    
                    <div class="space-y-4">
                      <!-- Job Title -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                          Job Title
                        </label>
                        @if (isEditing) {
                          <input
                            type="text"
                            [(ngModel)]="editedData.jobTitle"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                          >
                        } @else {
                          <p class="text-gray-900 dark:text-white">{{ userData.jobTitle || 'Not specified' }}</p>
                        }
                      </div>

                      <!-- Department -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                          Department
                        </label>
                        @if (isEditing) {
                          <input
                            type="text"
                            [(ngModel)]="editedData.department"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                          >
                        } @else {
                          <p class="text-gray-900 dark:text-white">{{ userData.department || 'Not specified' }}</p>
                        }
                      </div>

                      <!-- Employee ID -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                          Employee ID
                        </label>
                        @if (isEditing) {
                          <input
                            type="text"
                            [(ngModel)]="editedData.employeeId"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                          >
                        } @else {
                          <p class="text-gray-900 dark:text-white">{{ userData.employeeId || 'Not assigned' }}</p>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          }

          <!-- Settings Tab -->
          @if (activeTab === 'settings') {
            <div class="p-6">
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Account Settings</h3>
              <div class="text-center py-12">
                <lucide-icon [name]="shieldIcon" class="w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-4"></lucide-icon>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Account Settings</h3>
                <p class="text-gray-500 dark:text-gray-400">Security and preference settings will be available here</p>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
}